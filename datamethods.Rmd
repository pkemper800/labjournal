---
title: "finalpaper_datamethods"
author: "Paige Kemper"
date: "2025-10-31"
output: html_document
---


```{r, globalsettings, echo=FALSE, warning=FALSE, results='hide'}
library(knitr)

knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()


colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }


```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

Last compiled on `r format(Sys.time(), '%B, %Y')`

<br>


_Code for SNA Final Paper Data, Methods, and Results_

# Data and Methods Overview: 

## Data Collection 
The data used in this research is based on complete social network data of sociology and political science professors across eight universities in the Netherlands, compiled from web scraping using the OpenAlex. The large database used combines information on each professor, their position, university affiliation, names, id’s, departments, gender, and ethnicity. Additionally, each of the published works by each professor was compiled, including the collaborators. This spans 3 waves of data, from 2015 until 2025, however I focus on just the first two waves of data. The first ranges from 2015 to 2018, and the second from 2019 to 2023. From this data I focus first on all the authors from the Sociology and Political Science departments at the Radboud University (n=111), and then I expand to all universities (n=784).

Furthermore, I compared the collaboration networks in two periods of time, looking at the collaborations per the wave they are present in. The networks are directed networks, which means that it is assumed that the first author sends ties to all collaborators on a specific work. I decided to include directed ties from the first author, meaning that the first author listed on the publication is assumed to be the one sending the invitation for collaboration to the other author(s) on the publication. I made this decision based on the assumption that first authors are likely to take the lead in the collaboration process, such that gender of egos as initiators of collaborations can be analyzed. 

### Dependent Variable
The dependent variable in this research is the collaborations (or “ties”) within the network of collaborations between professors, such that the professors are the agents or nodes in the social network analysis. 

For context, a social network is defined as a finite set of actors and the relations defined on this set. The actors are social entities whose specific ties constitute the network. The dependent variable in social network analysis is also referred to as the creation of a tie or the maintenance of a tie (there is also the potential for ties to be broken, though that is not a consideration of this analysis (Snijders et al., 2011). 

Snijders TA, Ripley R, B'oda Z, V"or"os A, Preciado P (2025). Manual for RSiena. University of Groningen, Groningen, The Netherlands. R package version 1.5.0, https://www.stats.ox.ac.uk/~snijders/siena/. 

### Independent Variable
The primary independent variable in this research is gender. In my analysis, I used ‘female’ as the binary variable investigated. 

I also control for discipline, looking at department to observe if there are differences on the effect of gender between department. 
1.4 Analytical Strategy

### Analytical Approach
My analysis will include three core parts. 

First, I will prepare the data and provide a high-level overview of descriptive statistics for the key variables of this research. 

Second, I will review the descriptive statistics of the social network. This will provide meaningful information and context as to the dynamics at hand in collaboration networks of professors, with particular attention to the effect of gender on collaborations. I will present network descriptives and visualizations segmented by wave to observe the macro-level effects at hand. 

Third, I will use RSiena to provide an analysis for the network evolution. RSiena is a package that simulates a model for the collaboration network, with key parameters identified and included to improve simulation accuracy. Through this, networks are assumed to evolve based on actor attributes and preferences, and the RSiena models will allow us to attribute macro-level network evolution to micro-level changes. To best interpret the rsiena results, I will also include goodness of fit and relative influence testing. I will not include NAs in my analysis. 





# Part 1.1: Data Preparation - Radboud University 

Below are all of the steps I took to prepare the data for use, as well as a preliminary review of the variable descriptive statistics. 

## Clear data
```{r}
rm(list=ls()) #start clean
```


## Load Functions + Packages
```{r}
library(readxl)
library(selenider)
library(rvest)
library(tidyverse)
library(netstat)
library(pingr)
library(jsonlite)
library(stringr)
library(openalexR)


packages <- c("tidyverse", "scholar", "openalexR", "rvest", "jsonlite")
packages <- c("devtools", "igraph")

fpackage.check <- function(packages) {
    lapply(packages, FUN = function(x) {
        if (!require(x, character.only = TRUE)) {
            install.packages(x, dependencies = TRUE)
            library(x, character.only = TRUE)
        }
    })
}

fsave <- function(x, file = NULL, location = "./data/processed/") {
    ifelse(!dir.exists("data"), dir.create("data"), FALSE)
    ifelse(!dir.exists("data/processed"), dir.create("data/processed"), FALSE)
    if (is.null(file))
        file = deparse(substitute(x))
    datename <- substr(gsub("[:-]", "", Sys.time()), 1, 8)
    totalname <- paste(location, file, "_", datename, ".rda", sep = "")
    save(x, file = totalname)  #need to fix if file is reloaded as input name, not as x. 
}

fload <- function(filename) {
    load(filename)
    get(ls()[ls() != "filename"])
}

fshowdf <- function(x, ...) {
    knitr::kable(x, digits = 2, "html", ...) %>%
        kableExtra::kable_styling(bootstrap_options = c("striped", "hover")) %>%
        kableExtra::scroll_box(width = "100%", height = "300px")
}

```


Next, I will access large data file of professors (the set of egos for research).

### Load Dataset 
```{r}
scholars <- fload("C:/Github/labjournal/20251017scholars.Rda") 
```


### Isolate RU from RUG (rename Groningen Uni) 
This will make it easier to isolate Radboud, to run analysis on only Radboud before scaling to all universities in the Netherlands.
```{r}
scholars$demographics = scholars$demographics |>
  mutate(
    universiteit.22 = str_replace(universiteit.22, 'RUG', "UvG"),
    universiteit.24 = str_replace(universiteit.24, 'RUG', "UvG"),
    universiteit.25 = str_replace(universiteit.25, 'RUG', "UvG")
)
```


### New fcolnet function

### Define Network Data Helper Function
Note: Includes all other universities (and 'NA') + both sociology AND political science disciplines, so function will be able to first apply to Radboud AND scale to include all other universities. 
```{r}
fcolnet = function(data = scholars, university = c("RU", 'UU', 'VU', 'UvA', 'UvG', 'UvT', 'Leiden', 'EUR', 'NA'), discipline = c('Sociologie', 'Politicologie'), waves = list(c(2015,
    2018), c(2019, 2023), c(2024, 2025)), type = c("first")) {

    university = paste0('(', paste0(university, collapse='|' ), ')')
    discipline = paste0('(', paste0(discipline, collapse='|' ), ')')

    # step 1
    demographics = data$demographics
    sample = which(
        (str_detect(demographics$universiteit.22, university)
            | str_detect(demographics$universiteit.24, university)
            | str_detect(demographics$universiteit.25, university)
        ) & (
            str_detect(demographics$discipline.22, discipline)
            | str_detect(demographics$discipline.24, discipline)
            | str_detect(demographics$discipline.25, discipline)
        ) |> replace_na(FALSE))

    demographics_soc = demographics[sample, ] |> drop_na(id)

    # step 2
    ids = demographics_soc$id |> unique()


    scholars_sel = list() 
    for (id_ in ids){
        scholars_sel[[id_]] = bind_rows(scholars$works) |>
            filter(author_id == id_)
    }
    scholars_sel = bind_rows(scholars$works) 
    

    nwaves = length(waves)
    nets = array(0, dim = c(nwaves, length(ids), length(ids)), dimnames = list(wave = 1:nwaves, ids,
        ids))
    dimnames(nets)

    # step 3
    df_works = tibble(
            works_id = scholars_sel$id, 
            works_author = scholars_sel$authorships, 
            works_year = scholars_sel$publication_year
        )


    df_works = df_works[!duplicated(df_works), ]

    # step 4
    if (type == "first") {
        for (j in 1:length(waves)) {
            df_works_w = df_works[df_works$works_year >= waves[[j]][1] & df_works$works_year <= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego = df_works_w$works_author[i][[1]]$id[1]
                alters = df_works_w$works_author[i][[1]]$id[-1]
                if (sum(ids %in% ego) > 0 & sum(ids %in% alters) > 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] = 1
                }
            }
        }
    }

    if (type == "last") {
        for (j in 1:length(waves)) {
            df_works_w = df_works[df_works$works_year >= waves[[j]][1] & df_works$works_year <= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego = rev(df_works_w$works_author[i][[1]]$id[1])
                alters = rev(df_works_w$works_author[i][[1]]$id[-1])
                if (sum(ids %in% ego) > 0 & sum(ids %in% alters) > 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] = 1
                }
            }
        }
    }
    if (type == "all") {
        for (j in 1:length(waves)) {
            df_works_w = df_works[df_works$works_year >= waves[[j]][1] & df_works$works_year <= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                egos = df_works_w$works_author[i][[1]]$id
                if (sum(ids %in% egos) > 0) {
                  nets[j, which(ids %in% egos), which(ids %in% egos)] = 1
                }
            }
            diag(nets[j,,]) = 0
        }
    }

    output = list()
    output$data = demographics_soc
    output$nets = nets
    return(output)
}
```

This includes three waves of data, separated per the time they were pulled. For my analysis, I will only focus on the first two waves, since the third wave covers a smaller time period and may inadvertently distort results. 

In the future, it would be more ideal to include and confirm this analysis on a third wave of data, ideally with a similar time frame and/or analysis that would account for the difference in time frames. For this research though, using the first two waves of the data will already address the research questions.


### load Rsiena packages
Loading additional packages necessary for analysis of data. 
```{r}
packages = c(
    "RSiena", "tidyverse",
    'dplyr', 'stringr' # these packages were added to make the code run
)
fpackage.check(packages)

```


## Radboud Data
I now analyze female effect on collaborations for Radboud specifically, as a case study to then expand from. 

## Getting Data for Radboud 
I will create an adjacency matrix ('test') with the subset of professors from Radboud University, as well as a data frame with the ego-level characteristics I will be investigating. 

### Load Data
```{r}
# Radboud only (where I want to start)
test = fcolnet(scholars, 
               university = c("RU"), #only Radboud 
               discipline = c("Sociologie", "Politicologie"),
               type = c("first")) #directed 
df_ego = bind_rows(test$data)
```

This establishes the dataframes for preliminary analysis.  I will first try analysis of this subset from the "scholars" database with just professors from Radboud University, before then scaling analysis to all the universities. Notably, this database already includes both sociology and political science disciplines (departments for each respective university). I will analyze gender in collaborations, though it will be important later to control for the discipline. Additionally, this will look at the social network of collaboration patterns as directed, assuming that the first author initiates a collaboration. 


### Wrangle Data
Separate data waves (from when the data was pulled) to better analyze the evolution over time. 

```{r}
wave1 = test$nets[1,,]
wave2 = test$nets[2,,]
wave3 = test$nets[3,,] # code currently includes wave 3, however this wave is not included in my analysis (my analysis prioritizes waves 1 and 2). 

nets = array(
    data = c(wave1, wave2), # NOTE TO SELF: REMOVED WAVE 3 FROM 'NETS' 
    dim = c(dim(wave2), 2)
)

net = sienaDependent(nets)
```


## Isolate and Review Key Variables

### Isolate Gender variable (binary)
Make sure to include binary variable for gender, as gender is the independent variable that is analyzed in this research. With this, male = 0, and female = 1. Female is 1 because I hypothesize that women are more likely to collaborate. 

It is important to acknowledge that gender is an ego-level characteristic. COME BACK TO THIS TO EXPLAIN. 

```{r}
# Recoding for gender
df_ego = df_ego |>
    mutate(
        female = case_when(
            gender == "female" ~ 1,
            gender == "male" ~ 0,
            .default = NA 
        )
    )

female = coCovar(df_ego$female) #CREATE GENDER CO VARIABLE
```


### Isolate disicipline variable (binary, used for control)
I want to be able to control for the department, so I will create an additional binary variable denoting if the ego/professor is affiliated with sociology (0) or political science (1). This will serve as a constant covariate, looking at EgoX effect per discipline. Political science is 1 because literature found that political science departments at Dutch universities tend to have less balanced gender distribution than sociology, and I hypothesize that as a result, women will be more likely to participate in cross-gender collaborations, as it may be more important for their credibility and opportunity for promotion.  

```{r}
# Recoding for discipline, must include all three waves because authors scraped from most recent wave need to be accounted for. Latest discipline is the discipline that the professor is associated with (we assume that the discipline does not change).
df_ego = df_ego |>
    mutate(
        polsci = case_when(
            discipline.22 == "Politicologie" ~ 1, #assume discipline remains the same?
            discipline.22 == "Sociologie" ~ 0,
            discipline.24 == "Politicologie" ~ 1, #assume discipline remains the same?
            discipline.24 == "Sociologie" ~ 0,
            discipline.25 == "Politicologie" ~ 1, #assume discipline remains the same?
            discipline.25 == "Sociologie" ~ 0,
            .default = NA
        )
    )

polsci = coCovar(df_ego$polsci) #CREATE DISCIPLINE CO VAR
```




----



# Part 1.2: Preliminary Descriptives Statistics 

Reviewing at a high level at the descriptive statistics below, we can see several things. After recoding gender as a binary variable, such that male = 0, and female = 1 (to look at the effect of female), we can look at the distribution of female in among Radboud University professors.  

### Distribution of Gender (Female = 1) Overall 
```{r}
summary(df_ego$female)
```
The distribution of gender appears relatively balanced, with a mean of 0.5091, indicating slightly more women as professors, though remaining very close to .50, it is reasonable to assume that gender is equally distributed among professors at Radboud Univeristy. 


### Distribution of Discipline (Political Science = 1)
```{r}
summary(df_ego$polsci)
```
The distribution of discipline appears close to .5, with a mean of 0.4955, indicating slightly more sociology professors than political science professors. However, as the means remaining close to .50, it is reasonable to assume that discipline is also equally distributed among professors at Radboud. 


### Distribution of Gender by Discipline 
```{r}
table(df_ego$gender, df_ego$discipline.24, useNA = "ifany")
```
While there is near 50% proportion of men and women, and a near 50% proportion of political science and sociology professors, there is the chance that one discipline has imbalanced gender representation. Therefore, it is important to check. I do so by creating a simple table to check, as demonstrated. This shows that there are a few more female than male political science professors, though a near 50% proportion of men and women sociology professors. I then visualize this in the bar graph below. I used discipline counts from 2024 as the latest wave from the data I studied. 


### Plot Distribution of Gender by Discipline
```{r}
library(ggplot2)

df_ego %>%
  filter(!is.na(gender) & !is.na(discipline.24)) %>%
  ggplot(aes(x = discipline.24, fill = gender)) +
  geom_bar(position = "dodge") +
  labs(title = "Gender Distribution by Discipline",
       x = "Discipline", 
       y = "Count") +
  theme_minimal()
```
Additionally, as this analysis will control for discipline, the bar chart above visually demonstrated the distribution of men and woman across the different departments at Radboud university.


----



# Part 2: Network Descriptives for Radboud University


## Visualizing Networks - Radboud University Wave 1
Next, I provide network visualization of both waves of collaboration networks by political science and sociology professors, representing gender by coding male as blue and female as red, and representing amount of collaborations by increasing the size of the nodes (professors) that had more collaborations, Through this, we can visually get an understanding for the distribution of male and female professors, how much each published during the wave, and the connections - or collaborations - that took place via shared publications. 


#### Make adjacency matrix for first wave of RU data
```{r}
# make adjacency matrix with first wave of data
test_wave1ru <- igraph::graph_from_adjacency_matrix(
  test$nets[1,,], #for this example I take the first wave of data. (thus I select the array of networks and take the first matrix)
  mode = c("directed"), # directed from the first author
  weighted = NULL,
  diag = FALSE,
  add.colnames = NULL,
  add.rownames = NULL
)

test_wave1ru
```


#### RU Wave 1 - First plot of data (colored: women represented with red and men represented with blue)
```{r}
# changing V: Let’s make size proportional to betweenness score
# V(test_wave1ru)$size = betweenness(test_wave1ru, normalized = T, directed = TRUE) * 100 + 20  #after some trial and error

#plot to see if it worked 
plot(test_wave1ru,
  vertex.color = ifelse(df_ego$female == 1, "red", "blue"),
  vertex.label = NA,
  edge.width = 0.2,
  vertex.size = sqrt(igraph::degree(test_wave1ru))*3 + 5,
  edge.arrow.size =0.2)

dim(test_wave1ru) #check it works 
sum(is.na(test_wave1ru)) #check it is complete -- if 0 missing values


# how do I plot only the collaborations? 
# test_wave1ru_collabs <- 

```


## Visualizing Networks - Radboud University Wave 2

#### Make adjacency matrix for second wave of RU data
```{r}
test_wave2ru <- igraph::graph_from_adjacency_matrix(
  test$nets[2,,], #for this example I take the first wave of data. (thus I select the array of networks and take the first matrix)
  mode = c("directed"),
  weighted = NULL,
  diag = FALSE,
  add.colnames = NULL,
  add.rownames = NULL
)
```


#### RU Wave 2 - First plot of data (colored: women represented with red and men represented with blue)
```{r}
#V(test_wave2ru)$size = betweenness(test_wave2ru, normalized = T, directed = TRUE) * 100 + 8  #after some trial and error

#plot to see if it worked 
plot(test_wave2ru,
  vertex.color = ifelse(df_ego$female == 1, "red", "blue"),
  vertex.label = NA,
  edge.width = 0.2,
  vertex.size = sqrt(igraph::degree(test_wave2ru))*3 + 5,
  edge.arrow.size =0.2)
```



## Descriptive Statistics 
Next, it is important to look at measures of centrality. The number of degrees of connections is the simplest term for centrality. If there are differences in degree centrality, then we can illustrate nodes by differing size (for example) to accommodate for this. This is demonstrated in the wave 1 and wave 2 network visualizations of radboud political science and sociology professors collaboration networks, as the professors that participate in more collaborations (shared publications) have a larger node size.  

With the descriptive statistics, we want to describe if this network is complete, the size of this network, what kind of relationships there are (whether or not it is directed), and the node type (as well as if the tie is weighted). We will also briefly look at local and global transitivity, looking at both the dyads and triads that form in this collaboration network for reference. Considering this is not a big part of the research questions though, we will not focus on this in the analysis.  

Looking at the size of the network, we can see that there are 111 professors (n=111) across wave 1 and wave 2. We see that there are 31 collaborations that took place in wave 1, and 85 collaborations in wave 2. Additionally, we can look at the in-degree clustering that arose in order to better see the distribution of collaborations. Visualized in histograms below, we see in wave 1 that most professors have 0 degrees, several having 1 degree, and then only a few professors having 2 or more degrees, with the maximum number of degrees at 7 in wave 1 for Radboud University. Looking at summary statistics of degree distribution for wave 1, the mean degrees is 0.5586. 

We can then see in the second histogram, representing wave 2, that the distribution of collaborations shifted; while still the majority, fewer professors have 0 degrees compared to wave 1, which makes sense considering the professors have had more time to publish. Similarly, we can also see relatively more professors having between 1-4 degrees. From there, only a few professors have 5 or more degrees, with the maximum number of degrees at 15. Looking at summary statistics of the degree distribution, the average degrees of wave 2 is 1.532, nearly 1 entire degree higher than in wave 1. 



### Load Packages
```{r}
library(igraph)
require(igraph)

packages <- c("tidyverse", "scholar", "openalexR", "rvest", "jsonlite")
packages <- c("devtools", "igraph")
```


### Size 
```{r}
#SIZE
# number of nodes for RU professors - both sociology and political science 
vcount(test_wave1ru) #returns 111
vcount(test_wave2ru) #returns 111
```
There are 111 nodes in both wave 1 and wave 2 of this network, representing 111 professors in the Radboud University social network data.


### Edges
```{r}
#EDGES
# number of edges for RU professors
ecount(test_wave1ru) #returns 31
ecount(test_wave2ru) #returns 85
```
There are 31 edges in wave 1, and 85 edges in wave 2, representing collaborations/shared publications in the Radboud University social network data.


### In-Degree Clustering and Spread
```{r}
#DEGREE
# looking at clustering and spread
igraph::degree(test_wave1ru)
igraph::degree(test_wave2ru)


hist(table(degree(test_wave1ru)), xlab='indegree', main= 'Histogram of indegree') 
# every number is the degree level of each actor. We can see it is heavily skewed to the left. 
# Wave 1: see frequency of 7 for indegree 0:20, frequency of 0 for indegree 20:80, frequency 1 for indegree 100:150

hist(table(degree(test_wave2ru)), xlab='indegree', main= 'Histogram of indegree') 
# Similarly, we can see that wave 2 is also heavily left skewed.  
# Wave 2: see frequency of 8 for indegree 0:10, frequency of 2 for indegree 10:20, 0 for 20:50, 1 for 50:60. 
```
While we can see with the above histograms that there is left-skewed indegree distributions, indicating that the vast majority of egos collaborate between 0-1 times, the nuance of the distribution is unclear. We therefore will further inspect degree centrality for each wave. 


### Degree Centrality Wave 1
```{r}
#degree centrality w1 
degree_w1 <- degree(test_wave1ru)
degree_w1 <- as.data.frame(degree_w1)

# view(degree_w1)
ggplot(degree_w1, aes(as.numeric(degree_w1), colour = as.numeric(degree_w1) )) +
  geom_histogram(binwidth = .5) +
  labs(
    title = "Distribution Degrees Wave 1",
    x = "Distribution of Degrees",
    y = "Count"
  )  +
  ylim(0, 150) +
  theme_bw()
```
With this histogram, we can better see the distribution of collaborations, with most professors having 0 degrees, several having 1 degree, and then only a few professors having 2 or more degrees, with the maximum number of degrees at 7 in wave 1 for Radboud University. Looking at summary statistics of degree distribution for wave 1, the mean degrees is 0.5586. 

```{r}
summary(degree_w1)
```



### Degree Centrality Wave 2
```{r}
#degree centrality w2 
degree_w2 <- degree(test_wave2ru)
degree_w2 <- as.data.frame(degree_w2)
ggplot(degree_w2, aes(as.numeric(degree_w2), colour = as.numeric(degree_w2))) +
  geom_histogram(binwidth = .5) +
  labs(
    title = "Distribution Degrees Wave 2",
    x = "Distribution of Degrees",
    y = "Count"
  ) +
  ylim(0, 150) +
  theme_bw()
```
With this second histogram, we can also see the distribution of collaborations and how it shifted since wave 1. Most professors still have 0 degrees, though notably less professors have 0 degrees than in wave 1, which makes sense considering the professors have had more time to publish. Similarly, we can also see relatively more professors having between 1-4 degrees. From there, only a few professors have 5 or more degrees, with the maximum number of degrees at 15. Looking at summary statistics of the degree distribution, the average degrees of wave 2 is 1.532, nearly 1 entire degree higher than in wave 1. 

```{r}
summary(degree_w2)
```



### Transitivity 
Additionally, while transitivity is not a main focus for this research since we focus on the effect of gender in collaborations, it still is a meaningful descriptive statistic for describing the network. With this, we assume it is undirected (even though the network is directed), because the presence of transitivity is more of interest than the direction of it. 


### Dyad and Triad Census (for ref.)
Moving from local to global transitivity, we next look at triads for global transitivity. Global transitivity refers to the number of observed over the possible transitive triads. We can identify all transitive triads that have taken place, and then all possible triads. For this, we will first review dyads, still looking at dyads as directed considering that the network is assumed to be directed as initiated by the first author.

```{r}
igraph::dyad_census(test_wave1ru) #with plot -- works 
  # Returns: 4 mut, 23 asym, 6078 null 
igraph::dyad_census(test_wave2ru) #with plot -- works
  # Returns: 7 mut, 71 asym, 6027 null
```
The dyad census for wave 1 returns 4 mutual, 23 asymmetrical, and 6078 null collaborations. The dyad census for wave 2 returns 7 mutual, 71 asymmetrical, 6027 null collaborations. This is intuitive, as it is reasonable that the total number of collaborations would increase from wave 1 to wave 2, and that the total mutual collaborations in particular would increase, as authors who have collaborated before may be more comfortable with future partnerships (in reference to theoretical foundations/literature. COME BACK TO THIS.)



### Triad census, transitivity and triad allegation (for ref.)
We next review triads, assuming that they are undirected for simplicity, as this is for reference, in order to contextualize findings. 
We will briefly look at triad census, transitivity, and triad allegation for reference. While this is not essential to research, it is interesting to consider in the context of collaboration networks, and understanding the collaboration patterns at work. 

**Triad Census**
```{r}
igraph::triad_census(test_wave1ru) #with plot -- works
  # Returns:  [1] 218926   2422    416     10     14      8      9      6      1      0      1      0      0      1      1      0

igraph::triad_census(test_wave2ru) #with plot -- works
  # Returns:   [1] 213567   7306    709     25    106     41     34      6     10      1      0      1      4      2      2      1

```
The triad census generally demonstrates that from wave 1 to wave to, the proportion of collaborations generally increase across the board. This supports the theoretical assumptions that people who have collaborated before are likely to collaborate again, and are likely to collaborate with other egos that they are familiar with (or that their previous collaborators have collaborated with).


**Transitivity and Triad Allegation**
```{r}
library(sna)

# Wave 1
sna::triad.census(test$nets[1,,]) #with adj matrix of test_wave1ru -- triad.census of (test_w1) doesn't work. 
unloadNamespace("sna")  #detach this package again to avoid interference with other igraph functions 
  # Returns:         003  012  102   021D 021U 021C 111D 111U 030T 030C 201 120D 120U 120C 210 300
           # [1,] 218926 2422  416   10   14    8    9    6    1    0   1    0    0    1   1   0
  # Same as igraph triad census! 


igraph::transitivity(test_wave1ru, type = "global") #with plot
  # Returns: [1] 0.1578947
sna::gtrans(test$nets[1,,]) #triad census a different way, but this is with plot - need with adj mat:
  # Returns: [1] 0.1515152

triad_w1ru <- data.frame(sna::triad.census(test$nets[1,,])) #save as df, #with adj matrix
transitivity_w1 <- (3 * triad_w1ru$X300)/(triad_w1ru$X201 + 3 * triad_w1ru$X300) #X300 is variable for transitive triad (the fully closed triad) - we multiply by 3 because there are 3 possible transitive triads
transitivity_w1
  # Returns 0 (?)


# Wave 2
sna::triad.census(test$nets[2,,])
unloadNamespace("sna")  #I will detach this package again
   # Returns: 003    012   102   021D  021U  021C  111D  111U  030T  030C 201  120D  120U 120C  210  300
      # [1,] 213567  7306  709   25    106   41    34     6    10    1    0    1     4    2     2    1


triad_w2ru <- data.frame(sna::triad.census(test$nets[2,,])) #save as df

igraph::transitivity(test_wave2ru, type = "global")
  # Returns: [1] 0.2290909
sna::gtrans(test$nets[2,,]) #triad census a different way 
  # Returns: [1] 0.2741935


transitivity_w2 <- (3 * triad_w2ru$X300)/(triad_w2ru$X201 + 3 * triad_w2ru$X300) #X300 is variable for transitive triad (the fully closed triad)
# we multiply by 3 because there are 3 possible transitive triads
transitivity_w2
  # Returns: [1] 1

```

We find that transitivity of wave 1 is 0.1578947 (from igraph. From the SNA package, gtrans is similar, at 0.1515152). We find that the transitivity of wave 2 is 0.2290909 (from igraph. From the SNA package, gtrans is slightly larger, at 0.2741935). Additionally, when looking at transitive triads, we find transitivity to be 0 in wave 1 and 1 in wave 2. 





----


To answer my first research question, I will develop several tables summarizing the data analysis of cross-gender collaborations by gender, discipline, and wave. I will look at the total number of collaborations across both waves, and the proportion of cross-gender and same-gender collaborations out of these. I will also look at the total amount of male and female professors participating in the cross-gender collaborations, and the amount of male and female professors by discipline, to better understand and control for differences in departments. In comparing all of these, we will be able to see the proportions of cross-gender collaborations out of total collaborations over time, the proportion of male and female participation, and the variation in proportion of male and female participation by department, providing us a comprehensive understanding of gender and cross-gender collaboration effects. 

I hypothesize that furthermore, 'female' as an ego-level characteristic increases the potential for cross-gender collaborations.




# Part 3: RSiena Analysis - Radboud Profs

I use the RSiena package (Ripley et al., 2024) in R to test my hypothesis 2.1, 2.2 and 2.3. These hypotheses focus on the effect of gender on collaborations in the social network, and thus needs RSiena to test.


**Research Question 2:** How does gender effect potential for collaborations? 
-    Is one gender more likely to collaborate than the other? 

**Hypothesis:** I hypothesize that women are more likely to collaborate than men, such that 'female' as an ego-level characteristic increases the potential for collaborations. 

To answer this research question, as an explanatory research question that requires ypothesis testing, I will look at egoX effect, including the interaction with "female" and the control for department with "polsci". The rsiena model will simulate collaborations and compare the expected results of the impact of 'female' with the actual data in order to gauge the effect 'female' has on the potential for collaborations. 


I created several RSiena models for comparison. The primary model to answer my research question is ansM_main. 



## Rsiena results

For Radboud University in particular.

We will be looking at female (independent variable) effect on collaborations, including controls for discipline. I created several rsiena models in order to compare and see how much of an effect the different statistics, variables, controls have on the overall estimated model.


### ansM1 - Looking at (net, female): isolateNet, inPop.c, and egoX of "female"
``` {r}
 #check this later tho
mydata = sienaDataCreate(net, female) 
myeff = getEffects(mydata)
myeff = includeEffects(myeff, isolateNet, inPop.c)
myeff = includeEffects(myeff, egoX, interaction1 = "female") # Independent variable under investigation

# ONLY LOOKING AT FEMALE EFFECT FIRST - look at this in ansM3
# myeff = includeEffects(myeff, egoX, interaction1 = "polsci") # Control for sociology vs political science departments

# myeff = includeEffects(myeff, egoX, altX, diffX, interaction1 = "female") -- removing altX and diffX because they didn't help initial model at all! 


myAlgorithm = sienaAlgorithmCreate(
    projname = "finalpaper_ru")

ansM1 = siena07(
    myAlgorithm, 
    data = mydata, 
    effects = myeff,
    returnDeps = TRUE
)

ansM1

```
Estimates, standard errors and convergence t-ratios

                                       Estimate   Standard   Convergence 
                                                    Error      t-ratio   

Rate parameters: 
  0       Rate parameter                2.6776  ( 0.4955   )             

Other parameters: 
  1. eval outdegree (density)          -1.7542  ( 0.8515   )    0.2033   
  2. eval reciprocity                   1.5298  ( 0.5151   )   -0.2035   
  3. eval indegree-popularity (centrd)  0.4095  ( 0.0873   )    0.3796   
  4. eval network-isolate               6.5281  ( 2.1119   )   -0.2386   
  5. eval female ego                    2.0429  ( 1.4349   )   -0.0111   

Overall maximum convergence ratio:    0.4158 


From this preliminary model, we can see a high convergence ration, and high t-ratios, making the results less reliable. 



### ansM2 - Looking at (net, female): isolateNet, inPop.c, and egoX and sameX of "female"
```{r}
mydata2 = sienaDataCreate(net, female) 
myeff2 = getEffects(mydata2)
myeff2 = includeEffects(myeff, isolateNet, inPop.c)
myeff2 = includeEffects(myeff, egoX, sameX, interaction1 = "female") # better to include sameX too? 

myAlgorithm = sienaAlgorithmCreate(
    projname = "finalpaper_ru")

ansM2 = siena07(
    myAlgorithm, 
    data = mydata2, 
    effects = myeff2,
    returnDeps = TRUE
)
ansM2
```
Estimates, standard errors and convergence t-ratios

                                       Estimate   Standard   Convergence 
                                                    Error      t-ratio   

Rate parameters: 
  0       Rate parameter                2.7969  ( 0.5123   )             

Other parameters: 
  1. eval outdegree (density)          -2.0130  ( 1.0826   )    0.0848   
  2. eval reciprocity                   1.4854  ( 0.4972   )   -0.0243   
  3. eval indegree-popularity (centrd)  0.4111  ( 0.1205   )    0.2808   
  4. eval network-isolate               6.6122  ( 2.6827   )    0.0217   
  5. eval female ego                    2.0964  ( 1.7283   )   -0.0700   
  6. eval same female                   0.4344  ( 0.2658   )   -0.0099   

Overall maximum convergence ratio:    0.3302 


Next, expanding controls to account for female effect on collaborations with other females, we see better t-rations and a better convergence ratio, making the results more reliable, such that ansM2 is a better model than ansM1. However, we must also control for discipline, as well at the interaction that egoX and sameX has with "female". 


### Primary RSiena Model - Looking at (net, female, polsci): isolateNet, inPop.c, and egoX and sameX of "female", and interaction with sameX, controlling for polsci

```{r}
mydata_main = sienaDataCreate(net, female, polsci) 
myeff_main = getEffects(mydata_main)
myeff_main = includeEffects(myeff_main, isolateNet, inPop.c)
myeff_main = includeEffects(myeff_main, egoX, sameX, interaction1 = "female") # better to include sameX too? 

myeff_main = includeEffects(myeff_main, egoX, interaction1 = "polsci") #controlling for the effect of this (not an active variable)


myeff_main = includeInteraction(myeff_main, egoX, sameX, interaction1 = c("female", "female"))
# we want to see if female professors are then more likely to collaborate with other female professors, looking at the effect of gender on collaboration - however, this interaction over controls for them. 


myAlgorithm = sienaAlgorithmCreate(
    projname = "finalpaper_ru")

ansM_main = siena07(
    myAlgorithm, 
    data = mydata_main, 
    effects = myeff_main,
    returnDeps = TRUE
)

ansM_main

```
Show in New Window
Estimates, standard errors and convergence t-ratios

                                       Estimate   Standard   Convergence 
                                                    Error      t-ratio   

Rate parameters: 
  0       Rate parameter                2.8967  ( 0.5495   )             

Other parameters: 
  1. eval outdegree (density)          -2.5335  ( 0.7487   )    0.1562   
  2. eval reciprocity                   1.7616  ( 0.4719   )   -0.0874   
  3. eval indegree-popularity (centrd)  0.3812  ( 0.0680   )    0.3248   
  4. eval network-isolate               6.5023  ( 2.0307   )   -0.0743   
  5. eval female ego                    2.9438  ( 1.4583   )   -0.0975   
  6. eval same female                   0.5749  ( 0.2722   )    0.0253   
  7. eval polsci ego                   -1.5403  ( 0.7956   )    0.0315   
  8. eval female ego x same female     -0.8323  ( 0.6125   )   -0.1709   

Overall maximum convergence ratio:    0.3617 



This model converges with a maximum convergence ratio of 0.3617, and a rate parameter of 2.8967. There is a negative effect of density ('outdegree') at -2.5335, a positive effect of reciprocity at 1.7616, and a small positive effect of in-degree popularity at 0.3812. All of these effects remain significant, except for in-degree popularity, which has a high t-ratio.  

Further, effects of gender are also included to analyze their impact on collaborations, including egoX and sameX of female, egoX of polsci, and the interaction of egoX with sameX for female (preference to working with the same gender). Out of all of these effects introduced to estimate the effect of gender on collaborations, all except for the egoX effect of polsci (discipline qualifying as political science) appear significant. 

With this, there is evidence that 'female' has a positive effect on collaborations (and particularly collaborations with other females', that 'polsci' has a negative effect on collaborations, and that the interaction of 'female' with same-gender collaborations has a negative effect. With this, we see that the egoX effect of 'female' is relatively large at 2.9438, indicating that 'female' has a positive, statistically significant effect on collaborations, providing evidence that gender does have an impact on collaborations such that females are more likely to collaborate than males. Additionally we see that 'polsci' has a negative effect, such that professors in political science are less likely to collaborate than sociology professors. We see that females favor partnering with professors of the same gender when looking at sameX, however the effect of female on collaborating with another female is negative, providing evidence that 'female' egos are potentially more likely to partner with the opposite gender than male egos would be. 


While good convergence is indicated by the t-ratios being close to zero, we can see a high t-ratio for in-degree popularity, and an overall maximum convergence ratio that is higher than ideal, indicating that the convergence ratio is not great, casting some doubt on the results. 



## GOODNESS OF FIT 

With this, we will look at how myeff (which accounts for female as the independent variable) in algorithm actually distributes in indegree and outdegree goodness of fit. 

### Create function
```{r}
# Note: The geodesic distribution is not available from within RSiena, and therefore is copied from the help page of sienaGOF-auxiliary. GeodesicDistribution calculates the distribution of non-directed geodesic distances; 

GeodesicDistribution <- function(i, data, sims, period, groupName, varName, levls = c(1:5, Inf), cumulative = TRUE,
    ...) {
    x <- networkExtraction(i, data, sims, period, groupName, varName)
    require(sna)
    a <- sna::geodist(symmetrize(x))$gdist
    if (cumulative) {
        gdi <- sapply(levls, function(i) {
            sum(a <= i)
        })
    } else {
        gdi <- sapply(levls, function(i) {
            sum(a == i)
        })
    }
    names(gdi) <- as.character(levls)
    gdi
}
```


### GOF for ansM1

#### Indegree:
```{r}
# The following function is taken from the help page for sienaTest -- use "ansM1"

testall <- function(ansM_main) {
    for (i in which(ansM_main$test)) {
        sct <- score.Test(ansM_main, i)
        cat(ansM_main$requestedEffects$effectName[i], "\n")
        print(sct)
    }
    invisible(score.Test(ansM_main))
}

gofi0 <- sienaGOF(ansM_main, IndegreeDistribution, verbose = FALSE, join = TRUE, varName = "net")
# gofi0
plot(gofi0)

# variable name from example = net
# x-axis = indegree 
# y-axis = frequency (plotting the people with 0 in-degrees)

```
In this macro-level investigation, we look at the degree of spread over the numerous simulations performed in rseina based on the designated parameters. Then, in the above goodness of fit model, we do an in-degree count. With this, we can see 78 nodes in the observed network at 0 degrees, 93 nodes at 1 degree, and from there the number of nodes levels out from 101-109 nodes across 2-8 degrees. In comparing the red line of actual observations to the boxplot representing the degree of spread and the violin plot representing where the majority of data it, it is evident that this model underestimates the number of isolates and over estimates the number of actors with 2-6 ties, while underestimating the actors with few degrees. In short, we can see that this goodness of fit model underestimates at 0, overestimates between 1-5, and then evens out. 

In testing with the p-value, we test a set of variables against a set of fixed values, combining it into one test that takes into account if there is covariance in the variables. Traditionally that could be done with a t-test, however as this includes a more complicated set of variables, we used the Monte Carlo Mahaloanobis distance test p-value. This renders: 


#### Outdegree: 
```{r}
# outdegree distribution
gofi1 <- sienaGOF(ansM_main, OutdegreeDistribution, verbose = FALSE, join = TRUE, varName = "net")
plot(gofi1)
```
We also will look at the goodness of fit of outdegree distribution. As observed in the above goodness of fit model, the outdegree count encounters the opposite over- and underestimation of nodes at their respective degrees as the goodness of fit for the indegree distribution.  With this, we can see 67 nodes in the observed network at 0 degrees (overestimated in the goodness of fit model), 84 nodes at 1 degree (overestimated even more than at 0 degrees), and from there the number of nodes levels out from 101-111 nodes across 2-8 degrees (underestimated in the model).

Lastly, in reviewing the Triad Census, we see much better model fit. 

#### TriadCensus: 
```{r}
# triad census distribution
gofi2 <- sienaGOF(ansM_main, TriadCensus, verbose = FALSE, join = TRUE, varName = "net")
plot(gofi2)
```




## RELATIVE INFLUENCE 

Relative Influence Analysis - RU profs 

### Relative influence with ansM1
Since we cannot look at relative influence with an interaction plot, we refer to the second model to look at this. 
```{r}
RI <- RSiena:::sienaRI(data = mydata2, ans = ansM2)

RSiena:::plot.sienaRI(RI, addPieChart = TRUE)
```
In this micro-level investigation, we look at the proportion of influence of each effect on ego-level tiny-steps in predicting future collaborations. It is important to consider that with a micro-level investigation, when it is relevant there it the potential to have a large effect; however, it might not be relevant to each individual. This looks at whether or not the effects of outdegree, reciprocity, and in-degree popularity are relevant for many professors at Radboud.
 
With this plot, can look at the proportion of each effect on predicting future collaborations. We can see indegree-popularity as wlel as reciprocity increase from wave 1 to wave 2 though. 






